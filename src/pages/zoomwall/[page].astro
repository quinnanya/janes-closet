---
import BaseLayout from "../../layouts/base.astro";
import { memes } from "../../dataset.mjs";

export async function getStaticPaths({ paginate }) {
  return paginate(memes, { pageSize: 20 });
}

const { page } = Astro.props;

// this is a brittle hack that is technically unsupported and will probably break at some point...
const getGDriveID = (url) => url.match(/id=([^&]+)/)?.[1] || "none";
const getGDriveHotlinkUrl = (id) =>
  `https://drive.google.com/uc?export=view&id=${id}`;
---

<BaseLayout>
  <h2>Page {page.currentPage} / {page.lastPage}</h2>
  <nav>
    {page.url.prev ? (
      <a href={Astro.site.pathname.replace(/\/$/, "") + page.url.prev}>Prev</a>
    ) : null}
    {page.url.next ? (
      <a href={Astro.site.pathname.replace(/\/$/, "") + page.url.next}>Next</a>
    ) : null}
  </nav>

  <div id="gallery" class="zoomwall">
  {page.data.map((meme) => (
    <img src={Astro.site.pathname + meme.mediaPath} />
  ))}
  </div>
</BaseLayout>

<script type="module" hoist>
  import ZoomWall from "../../lib/zoomwall.js";
  window.onload =  () => {
    console.log(ZoomWall);
    const z = new ZoomWall(document.getElementById("gallery"));
  };
</script>

<style>
  nav {
    display: flex;
    gap: 3em;
  }


#gallery {
  font-size: 0;
  overflow: hidden;
}

#gallery img {
  width: auto;
  height: 15vw;
  opacity: 1;
  vertical-align: top;
  transform-origin: 0% 0%;
  transition-property: transform, opacity;
  transition-duration: 0.3s;
  transition-timing-function: ease-out;
}

#gallery.lightbox img {
  opacity: 0.3;
  transition-timing-function: ease-in;
}

#gallery.lightbox img.active {
  opacity: 1;
}

</style>
